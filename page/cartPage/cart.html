<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <h3 class="card-title" id="cartTitle">Xe đẩy hàng của quý khách (0)</h3>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-2">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxwhEs9ur2lm2jNAUXHr_1pEUP9ek1ZU9Y-g&usqp=CAU"
                                alt="Tên sản phẩm" class="img-fluid">
                        </div>
                        <div class="col-md-10">
                            <div class="card-body">
                                <button class="btn btn-danger float-end btn-delete"><i class="bi bi-trash"></i></button>
                                <h5 class="card-title">Goldient Boutique Hotel</h5>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p class="card-text">★★★★★</p>
                                    </div>
                                    <div class="col-md-10">
                                        <p class="address">Địa chỉ: Đà Lạt</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-pill bg-info px-3 py-1 me-3">
                                        <p class="mb-0">8.4</p>
                                    </div>
                                    <p class="mb-0 me-3" style="color: #0062ff; font-weight: bold;">Tuyệt vời</p>
                                    <p class="mb-0">2000 nhận xét</p>
                                </div>
                                <hr>
                                <div class="price text-end">
                                    <div>
                                        <p class="original-price fw-bold mb-0" style="font-size: larger;">1,946,160 đ
                                        </p>
                                        <p class="discounted-price">Bao gồm thuế và phí</p>
                                    </div>
                                </div>
                                <input type="checkbox" class="product-checkbox"> <span>Chọn sản phẩm này</span> 
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-2">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxwhEs9ur2lm2jNAUXHr_1pEUP9ek1ZU9Y-g&usqp=CAU"
                                alt="Tên sản phẩm" class="img-fluid">
                        </div>
                        <div class="col-md-10">
                            <div class="card-body">
                                <button class="btn btn-danger float-end btn-delete"><i class="bi bi-trash"></i></button>
                                <h5 class="card-title">River Prince Hotel</h5>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p class="card-text">★★★★★</p>
                                    </div>
                                    <div class="col-md-10">
                                        <p class="address">Địa chỉ: Đà Lạt</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-pill bg-info px-3 py-1 me-3">
                                        <p class="mb-0">8.4</p>
                                    </div>
                                    <p class="mb-0 me-3" style="color: #0062ff; font-weight: bold;">Tuyệt vời</p>
                                    <p class="mb-0">2000 nhận xét</p>
                                </div>
                                <hr>
                                <div class="price text-end">
                                    <div>
                                        <p class="original-price fw-bold mb-0" style="font-size: larger;">1,827,000 đ
                                        </p>
                                        <p class="discounted-price">Bao gồm thuế và phí</p>
                                    </div>
                                </div>
                                <input type="checkbox" class="product-checkbox"> <span>Chọn sản phẩm này</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="row g-0">
                        <div class="col-md-2">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRxwhEs9ur2lm2jNAUXHr_1pEUP9ek1ZU9Y-g&usqp=CAU"
                                alt="Tên sản phẩm" class="img-fluid">
                        </div>
                        <div class="col-md-10">
                            <div class="card-body">
                                <button class="btn btn-danger float-end btn-delete"><i class="bi bi-trash"></i></button>
                                <h5 class="card-title">Muong Thanh Dalat Hotel</h5>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p class="card-text">★★★★★</p>
                                    </div>
                                    <div class="col-md-10">
                                        <p class="address">Địa chỉ: Đà Lạt</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-pill bg-info px-3 py-1 me-3">
                                        <p class="mb-0">8.4</p>
                                    </div>
                                    <p class="mb-0 me-3" style="color: #0062ff; font-weight: bold;">Tuyệt vời</p>
                                    <p class="mb-0">2000 nhận xét</p>
                                </div>
                                <hr>
                                <div class="price text-end">
                                    <div>
                                        <p class="original-price fw-bold mb-0" style="font-size: larger;">3,388,720 đ
                                        </p>
                                        <p class="discounted-price">Bao gồm thuế và phí</p>
                                    </div>
                                </div>
                                <input type="checkbox" class="product-checkbox"> <span>Chọn sản phẩm này</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Tổng giá</h2>
                        <p class="total-price">Tổng giá: 0 đ</p>
                        <button class="btn btn-primary">Thanh toán</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            // Lấy tất cả các nút xóa
            const deleteButtons = document.querySelectorAll('.btn-delete');
            // Lấy tất cả các ô checkbox
            const checkboxes = document.querySelectorAll('.product-checkbox');

            // Hàm cập nhật số lượng sản phẩm trong tiêu đề "Xe đẩy hàng của quý khách"
            function updateCartItemCount() {
                const cartItemCount = document.querySelectorAll('.card').length - 2;
                const cartTitle = document.getElementById('cartTitle');
                cartTitle.textContent = `Xe đẩy hàng của quý khách (${cartItemCount})`;
            }

            // Lặp qua từng nút xóa và gán sự kiện click
            deleteButtons.forEach((button, index) => {
                button.addEventListener('click', (event) => {
                    const card = event.target.closest('.card');
                    showConfirmationDialog(card, index);
                });
            });

            // Lặp qua từng ô checkbox và gán sự kiện change
            checkboxes.forEach((checkbox) => {
                checkbox.addEventListener('change', () => {
                    const totalPrice = calculateTotalPrice();
                    updateTotalPrice(totalPrice);
                });
            });

            // Hàm lấy giá của sản phẩm từ thẻ card
            function getProductPrice(card) {
                const priceElement = card.querySelector('.original-price');
                return parseFloat(priceElement.textContent.replace(/[^\d.]/g, ''));
            }

            // Hàm tính tổng giá của các sản phẩm đã chọn
            function calculateTotalPrice() {
                let totalPrice = 0;
                checkboxes.forEach((checkbox, index) => {
                    if (checkbox.checked) {
                        const card = checkbox.closest('.card');
                        totalPrice += getProductPrice(card);
                    }
                });
                return totalPrice;
            }

            // Hàm cập nhật tổng giá
            function updateTotalPrice(amount) {
                const totalPriceElement = document.querySelector('.total-price');
                totalPriceElement.textContent = "Tổng giá: " + formatCurrency(amount, "VND");
            }

            // Hàm hiển thị hộp thoại xác nhận
            function showConfirmationDialog(card, index) {
                const confirmation = confirm("Bạn có chắc chắn muốn xóa sản phẩm này không?");
                if (confirmation) {
                    // Nếu checkbox tương ứng với sản phẩm này đã được tích vào, hãy cập nhật tổng giá
                    if (checkboxes[index].checked) {
                        const price = getProductPrice(card);
                        const totalPrice = calculateTotalPrice() - price;
                        updateTotalPrice(totalPrice);
                    }
                    card.remove();
                    updateCartItemCount();
                }
            }

            // Cập nhật số lượng sản phẩm ban đầu
            updateCartItemCount();

            // Cập nhật tổng giá khi trang vừa được tải lên
            const initialTotalPrice = calculateTotalPrice();
            updateTotalPrice(initialTotalPrice);

            // Hàm định dạng tiền tệ
            function formatCurrency(amount, currency) {
                return amount.toLocaleString('vi-VN', {
                    style: 'currency',
                    currency: currency
                });
            }
        });
    </script>